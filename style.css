/* =========================================
   1. المتغيرات والأساسيات (Contrast & Neon)
   ========================================= */
:root {
    --bg-dark: #070b14;
    --card-bg: rgba(15, 23, 42, 0.8);
    --border-dim: rgba(255, 255, 255, 0.1);
    --accent-x: #ff4757;
    --accent-o: #2e86de;
    --accent-glow: #2ed573;
    --text-main: #f1f5f9;
    --cell-size: calc(min(65vh, 90vw) / 10);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-main);
    height: 100vh; width: 100vw;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; direction: rtl;
}

/* 2. الخلفية المتحركة بانسيابية بطيئة */
#animated-bg {
    position: fixed; inset: 0; z-index: -1;
    background: radial-gradient(circle at 50% 50%, #1e293b 0%, #070b14 100%);
    animation: bgFlow 15s ease-in-out infinite alternate;
}

@keyframes bgFlow {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(1.1); opacity: 1; }
}

/* 3. إدارة الشاشات (Views) */
.view {
    position: absolute; inset: 0;
    display: none; align-items: center; justify-content: center;
    padding: 20px;
}
.view.active { display: flex; animation: viewIn 0.5s ease; }

@keyframes viewIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

/* 4. تصميم واجهة الدخول (XO Minimalist) */
.main-card {
    background: var(--card-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-dim);
    border-radius: 40px; padding: 50px;
    width: min(550px, 95%); text-align: center;
    box-shadow: 0 30px 60px rgba(0,0,0,0.5);
}

.logo { font-size: 5rem; font-weight: 900; letter-spacing: -2px; margin-bottom: 30px; }

.player-inputs { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
.player-inputs input {
    background: rgba(0,0,0,0.3); border: 1px solid var(--border-dim);
    padding: 18px; border-radius: 15px; color: white; text-align: center; font-size: 1.1rem;
}

.levels-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 40px; }
.level-btn {
    background: rgba(255,255,255,0.03); padding: 20px; border-radius: 20px;
    border: 2px solid transparent; cursor: pointer; transition: 0.3s;
    display: flex; align-items: center; gap: 15px;
}
.level-btn.active { border-color: var(--accent-o); background: rgba(46, 134, 222, 0.1); }
.lvl-num { font-size: 1.8rem; font-weight: 900; color: var(--accent-o); }
.lvl-name { font-weight: 600; }

.action-footer { display: flex; gap: 15px; }
.primary-btn, .secondary-btn {
    flex: 1; padding: 20px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; font-size: 1.1rem;
}
.primary-btn { background: var(--accent-o); color: white; }
.secondary-btn { background: rgba(255,255,255,0.1); color: white; }

/* 5. ساحة اللعب واللوحة الصلبة (Fixed Grid) */
.board-frame {
    background: rgba(255,255,255,0.02); padding: 10px; border-radius: 25px;
    border: 1px solid var(--border-dim);
}

#grid-81 {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    width: fit-content; height: fit-content;
}

.local-board {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;
    padding: 5px; border-radius: 10px; transition: 0.3s;
    position: relative;
}

/* تأثير الوميض (Glow) للمربع النشط */
.local-board.active-glow {
    box-shadow: 0 0 20px var(--accent-glow);
    background: rgba(46, 213, 115, 0.05);
}

/* الخلايا: تثبيت الأبعاد لمنع الزحف */
.cell {
    width: var(--cell-size); height: var(--cell-size);
    background: rgba(255,255,255,0.05); border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 2.2rem; font-weight: 900; cursor: pointer;
}
.cell.X { color: var(--accent-x); text-shadow: 0 0 10px var(--accent-x); }
.cell.O { color: var(--accent-o); text-shadow: 0 0 10px var(--accent-o); }

/* طبقة الفوز فوق المربع الكبير */
.win-overlay {
    position: absolute; inset: 0; background: var(--bg-dark);
    display: flex; align-items: center; justify-content: center;
    font-size: 4rem; font-weight: 900; border-radius: 10px; z-index: 5;
}

/* 6. النوافذ (Modals) */
.overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.85);
    backdrop-filter: blur(10px); z-index: 1000;
    display: none; align-items: center; justify-content: center;
}
.modal, .math-card {
    background: var(--card-bg); border-radius: 30px; padding: 35px;
    width: min(450px, 90%); text-align: center; border: 1px solid var(--border-dim);
}

.m-display { font-size: 3rem; font-weight: 900; margin: 20px 0; direction: ltr; }
.numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.numpad button {
    padding: 18px; border-radius: 12px; border: none; background: rgba(255,255,255,0.08);
    color: white; font-size: 1.5rem; font-weight: bold; cursor: pointer;
}
